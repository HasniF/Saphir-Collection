import Head from "next/head";
import styles from "@/styles/pages/Home.module.css";
import { motion, useMotionValue } from "framer-motion";
import { AnimatedText } from "@/components";
import Image from "next/image";
import { useContext, useEffect, useState } from "react";
import { AppContext } from "./_app";
import { useRouter } from "next/router";
import { useResetAppColor } from "@/hook/useResetAppColor";
import { hiddenMask, visibleMask } from "@/contract";

export const data = [
  {
    with: 250,
    height: 250,
    color: "#dd5b5b",
    bgColor: "#f0e3e3",
  },
  {
    with: 350,
    height: 250,
    color: "#ffffff",
    bgColor: "#ceb7a3",
  },
  {
    with: 150,
    height: 180,
    color: "#f4d8a6",
    bgColor: "#2d2720",
  },
  {
    with: 190,
    height: 200,
    color: "#f16120",
    bgColor: "#ededed",
  },
  {
    with: 250,
    height: 250,
    color: "#c6feff",
    bgColor: "#192327",
  },
];
/*
|--------------------------------------------------------------------------
| Animation
|--------------------------------------------------------------------------
*/
const paragraph = {
  initial: { opacity: 0, y: 20 },
  animate: {
    opacity: 1,
    y: 0,
    transition: {
      delay: 1.2,
      ease: [0.5, 1, 0.89, 1],
      duration: 0.8,
    },
  },
  exit: { opacity: 0, y: 20 },
};
/*
|--------------------------------------------------------------------------
| Component
|--------------------------------------------------------------------------
*/
const Home = () => {
  useResetAppColor();
  const context = useContext(AppContext);
  const router = useRouter();
  const mouse = {
    x: useMotionValue(0),
    y: useMotionValue(0),
  };

  // State
  //--------------------------------------------------------------------------
  const [imageClicked, setImageClicked] = useState<number | null>(null);

  // UseEffect
  //--------------------------------------------------------------------------
  useEffect(() => {
    window.addEventListener("mousemove", manageMouseMovement);
    return () => {
      window.removeEventListener("mousemove", manageMouseMovement);
    };
  }, []);

  // Methods
  //--------------------------------------------------------------------------
  const manageMouseMovement = (e: MouseEvent) => {
    mouse.x.set(e.clientX / -55);
    mouse.y.set(e.clientY / -55);
  };

  // Render
  //--------------------------------------------------------------------------
  return (
    <>
      <Head>
        <title>SAPHIR - HOME</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main
        className={styles.container}
        style={{
          background: context?.appColor.background,
          color: context?.appColor.text,
        }}
      >
        <motion.h1>
          <AnimatedText text="Saphir" className={styles.brand} />
          <AnimatedText text="Collection" className={styles.collection} />
        </motion.h1>
        <motion.p
          variants={paragraph}
          initial="initial"
          animate="animate"
          exit="exit"
        >
          Issue / <span>01</span>
        </motion.p>
        <div className={styles.image_container}>
          {data.map((item, index) => (
            <motion.div
              key={index}
              style={{ x: mouse.x, y: mouse.y }}
              layoutId={`myImage${index}`}
              transition={{
                layout: {
                  duration: 0.8,
                  ease: [0.33, 1, 0.68, 1],
                },
                maskImage: {
                  duration: 0.8,
                  delay: 1.2,
                  ease: [0.33, 1, 0.68, 1],
                },
              }}
              initial={{
                maskImage: context?.playHomeAnimation
                  ? hiddenMask
                  : visibleMask,
              }}
              animate={{ maskImage: visibleMask }}
              exit={{
                maskImage: index === imageClicked ? visibleMask : hiddenMask,
                transition: {
                  duration: 0.3,
                  ease: [0.5, 1, 0.89, 1],
                },
              }}
            >
              <Image
                src={`/images/${index}.jpg`}
                alt="Saphir Collection"
                width={item.with}
                height={item.height}
                onClick={() => {
                  setImageClicked(index);
                  context?.setPlayHomeAnimation(false);
                  context?.setAppColor({
                    background: item.bgColor,
                    text: item.color,
                  });
                  router.push(`product/${index}`);
                }}
              />
            </motion.div>
          ))}
        </div>
      </main>
    </>
  );
};

export default Home;
